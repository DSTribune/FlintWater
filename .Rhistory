sp<(7)*(15.34)^2+(20)*(18.23)^2
sp<-(7)*(15.34)^2+(20)*(18.23)^2
ns<-(8+21-2)
sp <- sqrt(sp/ns)
(132.86-127.44)+c(1,-1)*tq(ns)*sp*sqrt(sum((1/8)+(1/21)))
(132.86-127.44)+c(1,-1)*qt(ns)*sp*sqrt(sum((1/8)+(1/21)))
(132.86-127.44)+c(1,-1)*qt(.975,ns)*sp*sqrt(sum((1/8)+(1/21)))
(132.86-127.44)+c(-1,1)*qt(.975,ns)*sp*sqrt((1/8)+(1/21))
132.86-127.44+c(-1,1)*qt(.975,ns)*sp*sqrt(1/8+1/21)
sp<-((var(g1)+var(g2))/18)
sp<-sqrt((9*var(g1)+9*var(g2))/18)
g2
md + c(-1,1)*qt(.975,18)*sp*sqrt(1/5)
t.test(g2,g1,paired=FALSE,var.equal=TRUE)$conf
t.test(g2,g1,paired=TRUE,var.equal=TRUE)$conf
t.test(g2,g1,paired=TRUE)$conf
num <- 2
num <- (15.34^2/8 + 18.23^2/21)^2
den <- 3
den <- 15.34^4/8^2/7 + 18.23^4/21^2/20
mydf <- num/den
4
132.86-127.44 +c(-1,1)*qt(.975,mydf)*sqrt(15.34^2/8 + 18.23^2/21)
2
s/sqrt(10)
10/sqrt(100)
swirl()
swirl()
packageurl <- "http://cran.r-project.org/src/contrib/Archive/ggplot2/ggplot2_1.0.1.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
packageurl <- "http://cran.r-project.org/src/contrib/Archive/ggplot2/ggplot2_1.0.1.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
install.packages("proto")
packageurl <- "http://cran.r-project.org/src/contrib/Archive/ggplot2/ggplot2_1.0.1.tar.gz"
install.packages("proto")
install.packages(packageurl, repos=NULL, type="source")
library(swirl)
swirl()
2
7
(32-30)/(10/4)
15
qt(.95,15)
dim(fs)
t.test(fs,paired-TRUE)
d
3
t.test(fs$sheight-fs$fheight)
sd(fs$sheight-fs$fheight)/sqrt(1078)
11.7885 * sd(fs$sheight-fs$fheight)/sqrt(1078)
mybin
7
8
?pt
pt(2.5,15,lower.tail=FALSE)
qnorm(.95)
qnorm(.99)
pnorm(2)
pnorm(2,lower.tail=FALSE)
mybin
pbinom(6,size-8,prob=.5,lower.tail=FALSE)
pbinom(6,size=8,prob=.5,lower.tail=FALSE)
pbinom(6,size=8,prob=.5,lower.tail=TRUE)
pbinom(7,size=8,prob=.5,lower.tail=TRUE)
ppois(9, lower.tail=FALSE,lambda = 5)
install.packages("PKI")
install.packages("rsconnect")
list.of.packages <- c("ggplot2", "acs")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)>0) {install.packages(new.packages)}
library(ggplot2)
library(acs)
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(acs)
library(dplyr)
library(gdal)
library(maptools)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityMI")
wqDf <- read.csv("result.csv")
wqDf <- filter(wqDf, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted')
wqDf$MonitoringLocationIdentifier <- as.character(wqDf$MonitoringLocationIdentifier)
wqDf$ActivityStartDate <- as.POSIXct(wqDf$ActivityStartDate)
wqDf <- wqDf %>%
filter(ResultMeasureValue != "NA")
summary(wqDf$ResultMeasureValue)
ggplot(data=wqDf, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = 'blue') + ggtitle("Distribution of surface water dissolved chloride \n in Genesee County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&mimeType=csv&zip=yes&sorted=no", destfile = "stationLocationsMI")
#download.file("http://waterqualitydata.us/Station/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&mimeType=kml&zip=yes&sorted=no", destfile = "stationShapesMI")
sampleData <- wqDf %>%
group_by(MonitoringLocationIdentifier) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
print(sampleData)
#At this point we used QGIS to open the kml and extract the coordinates for these 5 unique sample locations
Lat = c(-83.79, -83.7902778, -83.8460698, -83.6693998, -83.4627282)
Long = c(42.9111111, 42.9119444, 42.9419733, 43.0003052, 43.1144707)
MonitoringLocationIdentifier = c("USGS-0414826544", "USGS-0414826545", "USGS-041482663", "USGS-430001083401006", "USGS-430645083274606")
coords <- data.frame(Lat, Long, MonitoringLocationIdentifier)
coords <- merge(x=coords, y=sampleData, by="MonitoringLocationIdentifier", all = TRUE)
coords
write.csv(coords,file="GeneseeSamples")
write.csv(coords,file="GeneseeSamples.csv")
coords
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualitySanilac")
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen <- filter(wqDf, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted')
wqGen$MonitoringLocationIdentifier <- as.character(wqGen$MonitoringLocationIdentifier)
wqGen$ActivityStartDate <- as.POSIXct(wqGen$ActivityStartDate)
wqGen <- wqGen %>%
filter(ResultMeasureValue != "NA")
summary(wqGen$ResultMeasureValue)
ggplot(data=wqGen, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = 'blue') + ggtitle("Distribution of surface water dissolved chloride \n in Genesee County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
sampleData <- wqGen %>%
group_by(MonitoringLocationIdentifier) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
print(sampleData)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen <- filter(wqGen, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted')
wqGen$MonitoringLocationIdentifier <- as.character(wqGen$MonitoringLocationIdentifier)
wqGen$ActivityStartDate <- as.POSIXct(wqGen$ActivityStartDate)
wqGen <- wqGen %>%
filter(ResultMeasureValue != "NA")
summary(wqGen$ResultMeasureValue)
ggplot(data=wqGen, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = 'blue') + ggtitle("Distribution of surface water dissolved chloride \n in Genesee County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
sampleData <- wqGen %>%
group_by(MonitoringLocationIdentifier) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
print(sampleData)
#At this point we used QGIS to open the kml and extract the coordinates for these 5 unique sample locations
Long = c(-83.79, -83.7902778, -83.8460698, -83.6693998, -83.4627282)
Lat = c(42.9111111, 42.9119444, 42.9419733, 43.0003052, 43.1144707)
MonitoringLocationIdentifier = c("USGS-0414826544", "USGS-0414826545", "USGS-041482663", "USGS-430001083401006", "USGS-430645083274606")
coords <- data.frame(Lat, Long, MonitoringLocationIdentifier)
coords <- merge(x=coords, y=sampleData, by="MonitoringLocationIdentifier", all = TRUE)
names(coords) <-  c("ID", "Lat", "Long", "Average [Cl-] (mg/l)", "Max [Cl-] (mg/l)", "Latest Sample", "Total Samples ")
wqSanilac <- read.csv("waterQualitySanilac.csv")
wqSanilac <- filter(wqSanilac, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted')
wqSanilac$MonitoringLocationIdentifier <- as.character(wqSanilac$MonitoringLocationIdentifier)
wqSanilac$ActivityStartDate <- as.POSIXct(wqSanilac$ActivityStartDate)
wqSanilac <- wqSanilac %>%
filter(ResultMeasureValue != "NA")
summary(wqSanilac$ResultMeasureValue)
ggplot(data=wqSanilac, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = 'blue') + ggtitle("Distribution of surface water dissolved chloride \n in Sanilac County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
wqSanilac <- read.csv("waterQualitySanilac.csv")
wqSanilac <- filter(wqSanilac, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted')
wqSanilac <- read.csv("waterQualitySanilac.csv")
head(wqSanilac)
head(wqSanilac,35)
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(acs)
library(dplyr)
library(gdal)
library(maptools)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen <- filter(wqGen, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted' | ResultStatusIdentifier == 'Final' | ResultStatusIdentifier == 'Historical')
wqGen$MonitoringLocationIdentifier <- as.character(wqGen$MonitoringLocationIdentifier)
wqGen$ActivityStartDate <- as.POSIXct(wqGen$ActivityStartDate)
wqGen <- wqGen %>%
filter(ResultMeasureValue != "NA")
summary(wqGen$ResultMeasureValue)
ggplot(data=wqGen, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = 'blue') + ggtitle("Distribution of surface water dissolved chloride \n in Genesee County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
sampleData <- wqGen %>%
group_by(MonitoringLocationIdentifier) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
print(sampleData)
sampleData <- wqGen %>%
group_by(MonitoringLocationIdentifier) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
print(sampleData)
stationLocations <- read.csv(file="stationLocations.csv")
stationLocations <- read.csv(file="stationLocationsMI.csv")
stationLocations
head(stationLocations)
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityWayne")
wqGen
head(wqGen)
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(acs)
library(dplyr)
library(gdal)
library(maptools)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen$County = "Genesee"
#The water planned to be sourced from Lake Huron is located in Sanilac County
#Source: http://www.nytimes.com/2014/05/26/business/detroit-plan-to-profit-on-water-looks-half-empty.html?_r=0
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualitySanilac")
wqSanilac <- read.csv("waterQualitySanilac.csv")
wqGen$County = "Sanilac"
#The majority of Detroits water is sourced from the Detroit River in Wayne County
#Source: http://www.dwsd.org/downloads_n/customer_service/customer_information/water_quality_report.pdf
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityWayne")
wqWayne <- read.csv("waterQualityWayne.csv")
wqGen$County = "Wayne"
wqDf <- rbind(wqGen, wqSanilac, wqWayne)
wqDf <- cbind(wqGen, wqSanilac, wqWayne)
wqDf <- rbind(wqGen, wqSanilac, wqWayne)
names(wqGen)
names(wqSanilac)
wqGen$County = "Sanilac"
wqGen$County = "Wayne"
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(dplyr)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen$County = "Genesee"
#The water planned to be sourced from Lake Huron is located in Sanilac County
#Source: http://www.nytimes.com/2014/05/26/business/detroit-plan-to-profit-on-water-looks-half-empty.html?_r=0
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualitySanilac")
wqSanilac <- read.csv("waterQualitySanilac.csv")
wqGen$County = "Sanilac"
#The majority of Detroits water is sourced from the Detroit River in Wayne County
#Source: http://www.dwsd.org/downloads_n/customer_service/customer_information/water_quality_report.pdf
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityWayne")
wqWayne <- read.csv("waterQualityWayne.csv")
wqGen$County = "Wayne"
names(wqGen)
names(wqSanilac)
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(dplyr)
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
wqGen <- read.csv("waterQualityGenesee.csv")
wqGen$County = "Genesee"
#The water planned to be sourced from Lake Huron is located in Sanilac County
#Source: http://www.nytimes.com/2014/05/26/business/detroit-plan-to-profit-on-water-looks-half-empty.html?_r=0
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualitySanilac")
wqSanilac <- read.csv("waterQualitySanilac.csv")
wqSanilac$County = "Sanilac"
#The majority of Detroits water is sourced from the Detroit River in Wayne County
#Source: http://www.dwsd.org/downloads_n/customer_service/customer_information/water_quality_report.pdf
#download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityWayne")
wqWayne <- read.csv("waterQualityWayne.csv")
wqWayne$County = "Wayne"
wqDf <- rbind(wqGen, wqSanilac, wqWayne)
wqDf <- filter(wqDf, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted' | ResultStatusIdentifier == 'Final' | ResultStatusIdentifier == 'Historical')
wqDf$MonitoringLocationIdentifier <- as.character(wqDf$MonitoringLocationIdentifier)
wqDf$ActivityStartDate <- as.POSIXct(wqDf$ActivityStartDate)
wqDf <- wqDf %>%
filter(ResultMeasureValue != "NA")
ggplot(data=wqDf, aes(ResultMeasureValue)) + geom_histogram(color = "black", fill = County) + ggtitle("Distribution of surface water dissolved chloride \n in Genesee, Sanilac, and Wayne County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
names(wqDf)
ggplot(data=wqDf, aes(ResultMeasureValue, fill = County)) + geom_histogram(color = "black") + ggtitle("Distribution of surface water dissolved chloride \n in Genesee, Sanilac, and Wayne County, USGS NAWQA") + ylab("Frequency") + xlab("mg/l Dissolved Chloride")
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n())
percentConc
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdev = sd())
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdError = sd
)
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdError = sd(ActivityStartDate, na.rm = TRUE))
percentConc
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdError = sd(ResultMeasureValue, na.rm = TRUE))
percentConc
ggplot(data=percentConc, aes(x=County, y=Avg) +
stat_boxplot(geom ='errorbar') +
geom_boxplot() # shorthand for  stat_boxplot(geom='boxplot')
ggplot(data=percentConc, aes(x=County, y=Avg)) +
stat_boxplot(geom ='errorbar') +
geom_boxplot()
class(percentConc)
percentConc
percentConc$County
percentConc$min <- percentConc$Avg - percentConc$stdError
percentConc$max <- percentConc$Avg + percentConc$stdError
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=whisk(percentConc),width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=percentConc,width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=percentConc,width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1 <- plot1 + ggtitle("Surface Water Chloride Concentrations /n in Genesse, Sanilac, and Wayne County MI (USGS)") + ylab("Average Chloride Concentration")
plot1
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=percentConc,width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1 <- plot1 + ggtitle("Surface Water Chloride Concentrations \n in Genesse, Sanilac, and Wayne County MI (USGS)") + ylab("Average Chloride Concentration")
plot1
Gen <- filter(wqDf, County = "Genesee")
Gen <- filter(wqDf, County == "Genesee")
Gen <- filter(wqDf, County == "Genesee")
San <- filter(wqDf, County == "Sanilac")
Way <- filter(wqDf, County == "Wayne")
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)
t.test(Gen$ResultMeasureValue, Way$ResultMeasureValue)
t.test(San$ResultMeasureValue, Way$ResultMeasureValue)
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=kml&zip=yes&sorted=no", destfile = "wayneStationCoords")
#Sanilac KML
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=kml&zip=yes&sorted=no", destfile = "sanilacStationCoords")
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&mimeType=kml&zip=yes&sorted=no", destfile = "wayneStationCoords")
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&mimeType=kml&zip=yes&sorted=no", destfile = "geneseeStationCoords")
download.file("http://waterqualitydata.us/Station/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&mimeType=kml&zip=yes&sorted=no", destfile = "geneseeStationCoords")
download.file("http://waterqualitydata.us/Station/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&mimeType=kml&zip=yes&sorted=no", destfile = "wayneStationCoords")
download.file("http://waterqualitydata.us/Station/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&mimeType=kml&zip=yes&sorted=no", destfile = "sanilacStationCoords")
unzip(zipfile='geneseeStationCoords.zip')
unzip(zipfile='geneseeStationCoords')
unzip(zipfile='geneseeStationCoords')
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", destfile = "waterQualityGenesee")
data <- read.table(unz("waterQualityGenesee.zip", "result.csv"))
unz("waterQualityGenesee.zip", "result.csv")
data <- read.csv(unz("waterQualityGenesee.zip", "result.csv"))
test <- unz("waterQualityGenesee.zip", "result.csv")
test
read.table(test)
read.table(test, open = 'rt')
read.table(test, open = "r")
read.table(test,"rt")
read.table(test,"wt")
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
data <- read.table(unz(temp, "result.csv"))
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
data <- read.csv(unz(temp, "result.csv"))
unlink(data)
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqGen<- read.csv(unz(temp, "result.csv"))
wqGen$County = "Genesee"
wqGen
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqSanilac<- read.csv(unz(temp, "result.csv"))
wqSanilac$County = "Sanilac"
wqSanilac
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(dplyr)
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqGen<- read.csv(unz(temp, "result.csv"))
wqGen$County = "Genesee"
#The water planned to be sourced from Lake Huron is located in Sanilac County
#Source: http://www.nytimes.com/2014/05/26/business/detroit-plan-to-profit-on-water-looks-half-empty.html?_r=0
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqSanilac<- read.csv(unz(temp, "result.csv"))
wqSanilac$County = "Sanilac"
#The majority of Detroits water is sourced from the Detroit River in Wayne County
#Source: http://www.dwsd.org/downloads_n/customer_service/customer_information/water_quality_report.pdf
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqWayne<- read.csv(unz(temp, "result.csv"))
wqWayne$County = "Wayne"
#Merge the three County Water Measurements
wqDf <- rbind(wqGen, wqSanilac, wqWayne)
wqDf <- filter(wqDf, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted' | ResultStatusIdentifier == 'Final' | ResultStatusIdentifier == 'Historical')
wqDf$MonitoringLocationIdentifier <- as.character(wqDf$MonitoringLocationIdentifier)
wqDf$ActivityStartDate <- as.POSIXct(wqDf$ActivityStartDate)
wqDf <- wqDf %>%
filter(ResultMeasureValue != "NA")
#What we want is a percentage of samples binned by concentration
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdError = sd(ResultMeasureValue, na.rm = TRUE))
ggplot(data=percentConc, aes(x=County, y=Avg)) +
stat_boxplot(geom ='errorbar') +
geom_boxplot()
percentConc$min <- percentConc$Avg - percentConc$stdError
percentConc$max <- percentConc$Avg + percentConc$stdError
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=percentConc,width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1 <- plot1 + ggtitle("Surface Water Chloride Concentrations \n in Genesse, Sanilac, and Wayne County MI (USGS)") + ylab("Average Chloride Concentration")
plot1
plot1
Gen <- filter(wqDf, County == "Genesee")
San <- filter(wqDf, County == "Sanilac")
Way <- filter(wqDf, County == "Wayne")
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)
t.test(Gen$ResultMeasureValue, Way$ResultMeasureValue)
t.test(San$ResultMeasureValue, Way$ResultMeasureValue)
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)$coef
coef(t.test(Gen$ResultMeasureValue, San$ResultMeasureValue))
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)$coef
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue).coef
t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)$p
yo = t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)
yo$p.value
Gen_San <- t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)$coef
Gen_Way <- t.test(Gen$ResultMeasureValue, Way$ResultMeasureValue)
San_Way <- t.test(San$ResultMeasureValue, Way$ResultMeasureValue)
Gen_San$p.value
Gen_San <- t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)
Gen_Way <- t.test(Gen$ResultMeasureValue, Way$ResultMeasureValue)
San_Way <- t.test(San$ResultMeasureValue, Way$ResultMeasureValue)
Gen_San$p
Gen_San$p.value
Gen_San$p.value
Gen_Way$p.value
San_Way$p.value
temp <- tempfile()
download.file("http://waterqualitydata.us/Station/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&mimeType=kml&zip=yes&sorted=no", temp)
genStations<- readLines(unz(temp, "station.kml"))
genStations
temp
unz(temp, "station.kml")
genStations<- readLines(unz(temp, "station.kml"))
setwd("~/DSTribune/Stories/FlintWaterQuality")
library(ggplot2)
library(dplyr)
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A049&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqGen<- read.csv(unz(temp, "result.csv"))
wqGen$County = "Genesee"
#The water planned to be sourced from Lake Huron is located in Sanilac County
#Source: http://www.nytimes.com/2014/05/26/business/detroit-plan-to-profit-on-water-looks-half-empty.html?_r=0
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A151&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqSanilac<- read.csv(unz(temp, "result.csv"))
wqSanilac$County = "Sanilac"
#The majority of Detroits water is sourced from the Detroit River in Wayne County
#Source: http://www.dwsd.org/downloads_n/customer_service/customer_information/water_quality_report.pdf
temp <- tempfile()
download.file("http://waterqualitydata.us/Result/search?countrycode=US&statecode=US%3A26&countycode=US%3A26%3A163&sampleMedia=Water&characteristicType=Inorganics%2C+Major%2C+Non-metals&characteristicName=Chloride&mimeType=csv&zip=yes&sorted=no", temp)
wqWayne<- read.csv(unz(temp, "result.csv"))
wqWayne$County = "Wayne"
#Merge the three County Water Measurements
wqDf <- rbind(wqGen, wqSanilac, wqWayne)
wqDf <- filter(wqDf, ActivityMediaSubdivisionName == "Surface Water", ResultSampleFractionText == 'Dissolved', ResultStatusIdentifier == 'Accepted' | ResultStatusIdentifier == 'Final' | ResultStatusIdentifier == 'Historical')
wqDf$MonitoringLocationIdentifier <- as.character(wqDf$MonitoringLocationIdentifier)
wqDf$ActivityStartDate <- as.POSIXct(wqDf$ActivityStartDate)
wqDf <- wqDf %>%
filter(ResultMeasureValue != "NA")
#What we want is a percentage of samples binned by concentration
percentConc<- wqDf %>%
group_by(County) %>%
summarise(Avg = mean(ResultMeasureValue, na.rm = TRUE),
Max = max(ResultMeasureValue, na.rm = TRUE),
LatestSample = max(ActivityStartDate, na.rm = TRUE),
totalSamples = n(),
stdError = sd(ResultMeasureValue, na.rm = TRUE))
ggplot(data=percentConc, aes(x=County, y=Avg)) +
stat_boxplot(geom ='errorbar') +
geom_boxplot()
percentConc$min <- percentConc$Avg - percentConc$stdError
percentConc$max <- percentConc$Avg + percentConc$stdError
plot1 <- ggplot(percentConc, aes(x=County))
plot1 <- plot1 + geom_errorbar(aes(ymin=min,ymax=max),data=percentConc,width = 0.5)
plot1 <- plot1 + geom_boxplot(aes(y=Avg))
plot1 <- plot1 + ggtitle("Surface Water Chloride Concentrations \n in Genesse, Sanilac, and Wayne County MI (USGS)") + ylab("Average Chloride Concentration")
plot1
#Just looking initially at potential corrosivity of initial surface water across the three counties it seems that Wayne County which contains the Detroit River may have a slight
# advantage because initial concentrations of chloride are lower
Gen <- filter(wqDf, County == "Genesee")
San <- filter(wqDf, County == "Sanilac")
Way <- filter(wqDf, County == "Wayne")
Gen_San <- t.test(Gen$ResultMeasureValue, San$ResultMeasureValue)
Gen_Way <- t.test(Gen$ResultMeasureValue, Way$ResultMeasureValue)
San_Way <- t.test(San$ResultMeasureValue, Way$ResultMeasureValue)
Gen_San$p.value
Gen_Way$p.value
San_Way$p.value
#Indeed initial untreated surface water concentrations of chloride are significantly lower in Wayne County compared to Sanilac and Genesee
#We should get more granular now and display these samples relative to the three sites rather than entire counties
